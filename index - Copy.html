<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Block Dominoes</title>
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/mobile.css" />
  <link rel="stylesheet" href="/mobile.css" media="(max-width: 900px)" />
  <style>
    .desktop-only { display: block; }
    .mobile-only { display: none; }
    @media (max-width: 900px) {
      .desktop-only { display: none; }
      .mobile-only { display: block; }
    }
  </style>
</head>
<body>
  <!-- Lobby/sign-in UI -->
  <div id="lobby-container">
    <!-- Suggestion Box (header moved here) -->
    <div id="suggestion-box-container">
      <div id="dam-header">Domino4 <span class="by-text">by</span> <span class="producer">DAM Productions</span></div>
      <button id="toggle-suggestion-btn">ğŸ’¡ BuzÃ³n de Sugerencias</button>
      <div id="suggestion-box" class="hidden">
        <h4>ğŸ¯ AyÃºdanos a Mejorar</h4>
        <textarea id="suggestion-text" placeholder="Comparte tus ideas, sugerencias o reporta problemas..." maxlength="500"></textarea>
        <div id="suggestion-actions">
          <button id="submit-suggestion-btn">ğŸ“¤ Enviar</button>
          <button id="cancel-suggestion-btn" type="button">âŒ Cancelar</button>
        </div>
        <div id="suggestion-status"></div>
      </div>
    </div>

    <h2>Crear Su Perfil</h2>
    <button id="show-rules-btn">ğŸ“– Domino4 - Reglas del Juego</button>
    <div id="profile-status"></div>

    <div class="avatar-flex-row-wrapper">
      <div class="avatar-flex-row">
        <div id="avatar-selection">
          <h3>Seleccione Su Avatar</h3>
          <div id="avatar-grid">
            <!-- avatar options -->
            <div class="avatar-option" data-avatar="ğŸ˜">ğŸ˜</div>
            <div class="avatar-option" data-avatar="ğŸ¤ ">ğŸ¤ </div>
            <div class="avatar-option" data-avatar="ğŸ¥³">ğŸ¥³</div>
            <div class="avatar-option selected" data-avatar="ğŸ¯">ğŸ¯</div>
            <div class="avatar-option" data-avatar="ğŸ²">ğŸ²</div>
            <div class="avatar-option" data-avatar="ğŸ®">ğŸ®</div>
            <div class="avatar-option" data-avatar="ğŸ¤©">ğŸ¤©</div>
            <div class="avatar-option" data-avatar="ğŸ˜ˆ">ğŸ˜ˆ</div>
            <div class="avatar-option" data-avatar="âš¡">âš¡</div>
            <div class="avatar-option" data-avatar="ğŸ”¥">ğŸ”¥</div>
            <div class="avatar-option" data-avatar="ğŸ’">ğŸ’</div>
            <div class="avatar-option" data-avatar="ğŸ¤–">ğŸ¤–</div>
            <div class="avatar-option" data-avatar="ğŸŒŸ">ğŸŒŸ</div>
            <div class="avatar-option" data-avatar="ğŸ†">ğŸ†</div>
            <div class="avatar-option" data-avatar="ğŸ‘‘">ğŸ‘‘</div>
            <div class="avatar-option" data-avatar="ğŸŠ">ğŸŠ</div>
          </div>
          <div id="custom-avatar-section">
            <h4>O Suba Su Propia Imagen</h4>
            <label for="avatar-upload" class="custom-file-upload">ğŸ“ Seleccionar Archivo</label>
            <input type="file" id="avatar-upload" accept="image/*" title="Suba su avatar personalizado" />
            <div id="custom-avatar-preview"></div>
          </div>
        </div>
      </div>
      <div id="available-rooms"></div>
    </div>

    <input type="text" id="name-input" placeholder="Su Nombre o Iniciales" maxlength="9" />
    <div class="flex-row">
      <input type="text" id="room-input" placeholder="Sala nombre(opcional)" />
      <label for="target-score" class="puntaje-label">Puntaje:</label>
      <select id="target-score" class="puntaje-select">
        <option value="70" selected>70</option>
        <option value="100">100</option>
        <option value="50">50</option>
        <option value="30">30</option>
      </select>
    </div>

    <div id="profile-actions">
      <button id="set-name-btn">Entrar al Juego</button>
      <button id="clear-profile-btn" type="button">Borrar Perfil Guardado</button>
    </div>
  </div>

  <!-- Game UI -->
  <div id="canvas-container"></div>
  <div id="game-ui" >
    <div class="game-ui-top-row">
      <div class="game-ui-main">
        <div class="team-room-row">
          <div id="team-info"></div>
        </div>
        <div id="player-display-bottom" class="player-display"></div>
        <div id="player-display-left" class="player-display vertical-layout"></div>
        <div id="player-display-top" class="player-display"></div>
        <div id="player-display-right" class="player-display vertical-layout"></div>
        <div id="scoreboard"></div>
        <div id="matches-won-container"></div>
         
        <div id="restart-game-container">
          <!-- Main Game UI (Desktop Only) -->
          <div class="desktop-only">
          <button id="restart-game-btn-desktop">ğŸ”„ Restart Game</button>
          </div>
          <!-- Chat/Scroll Area (Mobile Only) -->
          <div class="mobile-only" style="padding: 10px; margin: 10px;">
            <button id="stubborn-toggle-btn" 
                    onclick="if(!this.touchHandled) { var box = document.getElementById('stubborn-container'); if(box) { var isHidden = box.style.display === 'none' || box.style.display === ''; if(isHidden) { box.style.setProperty('display', 'block', 'important'); } else { box.style.setProperty('display', 'none', 'important'); } } }" 
                    ontouchstart="this.touchHandled = true; var box = document.getElementById('stubborn-container'); if(box) { var isHidden = box.style.display === 'none' || box.style.display === ''; if(isHidden) { box.style.setProperty('display', 'block', 'important'); } else { box.style.setProperty('display', 'none', 'important'); } } setTimeout(() => { this.touchHandled = false; }, 500);"
                    style="background: #ffc107; color: black; border: 1px solid #ccc; padding: 8px 12px; border-radius: 5px; margin-right: 10px; cursor: pointer; font-size: 14px;">ğŸ’¡ <span id="stubborn-btn-text">BuzÃ³n</span></button>
            <button id="show-rules-btn-mobile">ğŸ“– Game Rules</button>
            <button id="restart-game-btn-mobile">ï¿½ Restart Game</button>
          </div>
          
        </div>
        
        <!-- STUBBORN Mobile Suggestion Box - Fresh Start -->
        <div id="stubborn-container" class="mobile-only" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; background: white; border: 2px solid #007bff; border-radius: 10px; padding: 15px; max-width: 90%; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">
          <h4 style="margin: 0 0 10px 0; color: #007bff;">ğŸ¯ <span id="stubborn-title">AyÃºdanos a Mejorar</span></h4>
          <textarea id="stubborn-text" placeholder="Comparte tus ideas, sugerencias o reporta problemas..." maxlength="500" style="width: 100%; height: 80px; border: 1px solid #ccc; border-radius: 5px; padding: 8px; box-sizing: border-box; resize: vertical;"></textarea>
          <div style="margin-top: 10px; text-align: center;">
            <button id="stubborn-send-btn" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-right: 10px; cursor: pointer; pointer-events: auto;">ğŸ“¤ <span id="stubborn-send-text">Enviar</span></button>
            <button id="stubborn-close-btn" onclick="document.getElementById('stubborn-container').style.setProperty('display', 'none', 'important');" style="background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">âŒ <span id="stubborn-close-text">Cerrar</span></button>
          </div>
          <div id="stubborn-status" style="margin-top: 10px; text-align: center; font-size: 14px;"></div>
        </div>
        
        <div id="message-display"></div>
        <div id="game-buttons">
          <button id="playLeftBtn">Izquierda</button>
          <button id="playRightBtn">Derecha</button>
          <button id="passBtn">Paso</button>
        </div>
        <div id="new-round-container">
          <div id="round-over-message"></div>
          <button id="newRoundBtn">Empezar Mano Nueva</button>
        </div>
        <div id="chat-container">
          <div id="chat-messages"></div>
          <form id="chat-input-form">
            <input type="text" id="chat-input" placeholder="Type a message..." autocomplete="off" />
            <button type="submit">Send</button>
            <button id="voice-chat-btn" type="button">ğŸ¤Presione y hable</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile-only scroll/chat area (hidden on desktop) -->
  <div id="scroll-panel" class="mobile-only">
    <div id="mobile-chat"></div>
    <div id="matches-won-container"></div>
    <div id="mobile-points-table"></div>
    <button id="scroll-rules-btn" class="scroll-panel-btn">ğŸ“– Game Rules</button>
  </div>
 
  <!-- Game Rules Modal -->
  <div id="rules-modal">
    <div id="rules-modal-content">
      <button id="close-rules-btn" class="close">âœ–</button>
      <h2>Domino4 - Reglas del Juego</h2>
      <ol>
        <li>El juego es para 4 jugadores en equipos de 2.</li>
        <li>El juego empieza cuando los 4 jugadores esten inscritos</li>
        <li>El juego rota las parejas despues de cada match</li>
        <li>Cada jugador recibe 7 fichas de dominÃ³.</li>
        <li>El jugador con el doble 6 inicia la partida.</li>
        <li>Los turnos son en sentido contra del reloj.</li>
        <li>Debe colocar una ficha que coincida con los extremos del tablero.</li>
        <li>Si no puede jugar, debe pasar su turno.</li>
        <li>El primer equipo que se quede sin fichas gana la mano, o el equipo con menos puntos si el juego se cierra.</li>
        <li>Si hay un cierre y empate en puntos, nadie gana y quien tenga el doble 6 inicia la siguiente mano</li>
        <li>El primer equipo en alcanzar el puntaje objetivo (70) gana el juego, este valor se puede cambiar al registrarse.</li>
        <li>Puede crear su propia sala de juego o unirse a una existente.</li>
      </ol>
      <p>Consulte las reglas completas con el organizador o en lÃ­nea.</p>
    </div>
  </div>
  <!-- Scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js"></script>
  <script src="/client.js"></script>
  <script>
function showGameUI() {
  console.log('ğŸ¯ Transitioning to Game UI...');
  document.getElementById('lobby-container').style.display = 'none';
  document.getElementById('game-ui').style.display = 'block';
  const scrollPanel = document.getElementById('scroll-panel');
  if (scrollPanel) scrollPanel.style.display = 'block';
  
  // Setup mobile suggestion box for game UI after elements are visible
  if (typeof setupStubbornBox === 'function') {
    setupStubbornBox();
  }
}

document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, setting up buttons...');
  setupGameButtons();
});
</script>
</body>
</html>