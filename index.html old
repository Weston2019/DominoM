<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Block Dominoes</title>
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/mobile.css" media="(max-width: 900px)" />
</head>
<body>
  <!-- Lobby/sign-in UI -->
  <div id="lobby-container">
    <div id="logo-container">
      <div id="game-logo">Domino4 <span class="by-text">by</span> <span class="producer">DAM Productions</span></div>
    </div>

    <!-- Suggestion Box -->
    <div id="suggestion-box-container">
      <button id="toggle-suggestion-btn">💡 Buzón de Sugerencias</button>
      <div id="suggestion-box" class="hidden">
        <h4>🎯 Ayúdanos a Mejorar</h4>
        <textarea id="suggestion-text" placeholder="Comparte tus ideas, sugerencias o reporta problemas..." maxlength="500"></textarea>
        <div id="suggestion-actions">
          <button id="submit-suggestion-btn">📤 Enviar</button>
          <button id="cancel-suggestion-btn" type="button">❌ Cancelar</button>
        </div>
        <div id="suggestion-status"></div>
      </div>
    </div>
<!-- Sign-in area -->
<div id="language-selector-wrapper" >
  <label for="language-select">Idioma:</label>
  <select id="language-select">
    <option value="es" selected>Español</option>
    <option value="en">English</option>
  </select>
</div>
<div id="signin-header">
  <div id="game-logo">Domino4 <span class="by-text">by</span> <span class="producer">DAM Productions</span></div>
  <div id="language-selector-wrapper">
    <label for="language-select">Idioma:</label>
    <select id="language-select">
      <option value="es" selected>Español</option>
      <option value="en">English</option>
    </select>
  </div>
</div>



    <h2>Crear Su Perfil</h2>
    <div id="rules-button-wrapper-signin">
  <button id="show-rules-btn-signin" class="rules-button">📖 DominoM - Reglas del Juego</button>
</div>
    <div id="profile-status"></div>
    <div class="avatar-flex-row-wrapper">
      <div class="avatar-flex-row">
        <div id="avatar-selection">
          <h3>Seleccione Su Avatar</h3>
          <div id="avatar-grid">
            <!-- avatar options -->
            <div class="avatar-option" data-avatar="😎">😎</div>
            <div class="avatar-option" data-avatar="🤠">🤠</div>
            <div class="avatar-option" data-avatar="🥳">🥳</div>
            <div class="avatar-option selected" data-avatar="🎯">🎯</div>
            <div class="avatar-option" data-avatar="🎲">🎲</div>
            <div class="avatar-option" data-avatar="🎮">🎮</div>
            <div class="avatar-option" data-avatar="🤩">🤩</div>
            <div class="avatar-option" data-avatar="😈">😈</div>
            <div class="avatar-option" data-avatar="⚡">⚡</div>
            <div class="avatar-option" data-avatar="🔥">🔥</div>
            <div class="avatar-option" data-avatar="💎">💎</div>
            <div class="avatar-option" data-avatar="🤖">🤖</div>
            <div class="avatar-option" data-avatar="🌟">🌟</div>
            <div class="avatar-option" data-avatar="🏆">🏆</div>
            <div class="avatar-option" data-avatar="👑">👑</div>
            <div class="avatar-option" data-avatar="🎊">🎊</div>
          </div>
          <div id="custom-avatar-section">
            <h4>O Suba Su Propia Imagen</h4>
            <label for="avatar-upload" class="custom-file-upload">📁 Seleccionar Archivo</label>
            <input type="file" id="avatar-upload" accept="image/*" title="Suba su avatar personalizado" />
            <div id="custom-avatar-preview"></div>
          </div>
        </div>
      </div>
      <div id="available-rooms"></div>
    </div>

    <input type="text" id="name-input" placeholder="Su Nombre o Iniciales" maxlength="9" />
    <div class="flex-row">
      <input type="text" id="room-input" placeholder="Sala nombre(opcional)" />
      <label for="target-score" class="puntaje-label">Puntaje:</label>
      <select id="target-score" class="puntaje-select">
        <option value="70" selected>70</option>
        <option value="100">100</option>
        <option value="50">50</option>
        <option value="30">30</option>
      </select>
    </div>

    <div id="profile-actions">
      <button id="set-name-btn">Entrar al Juego</button>
      <button id="clear-profile-btn" type="button">Borrar Perfil Guardado</button>
    </div>
  </div>

  <!-- Game UI -->
  <div id="canvas-container"></div>
  <div id="game-ui" >
    <div class="game-ui-top-row">
      <div class="game-ui-main">
        <div class="team-room-row">
          <div id="team-info"></div>
        </div>
        <div id="player-display-bottom" class="player-display"></div>
        <div id="player-display-left" class="player-display vertical-layout"></div>
        <div id="player-display-top" class="player-display"></div>
        <div id="player-display-right" class="player-display vertical-layout"></div>
        <div id="scoreboard">
  <div class="score-label">Scores</div>
  <div>Team A: 0</div>
  <div>Team B: 0</div>
</div>

        <div id="matches-won-container"></div>
        <div id="restart-game-container">
        <button id="restart-game-btn">🔄 Reiniciar Juego</button>
        </div>
        <div id="message-display"></div>
        <div id="game-buttons">
          <button id="playLeftBtn">Izquierda</button>
          <button id="playRightBtn">Derecha</button>
          <button id="passBtn">Paso</button>
        </div>
        <div id="new-round-container">
          <div id="round-over-message"></div>
          <button id="newRoundBtn">Empezar Mano Nueva</button>
        </div>
      <div id="ui-divider"></div>
        <div id="chat-container">
          <div id="chat-messages"></div>
          <form id="chat-input-form">
            <input type="text" id="chat-input" placeholder="Type a message..." autocomplete="off" />
            <button type="submit">Send</button>
            <button id="voice-chat-btn" type="button">🎤Presione y hable</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile scroll panel -->
    <div id="scroll-panel" class="mobile-only">
  <div id="mobile-chat"></div>
  <div id="mobile-points-table"></div>
  <div id="rules-button-wrapper-mobile">
  <button id="show-rules-btn-scroll" class="rules-button">📖 DominoM - Reglas del Juego</button>
</div>

</div>
  
   <div id="orientation-warning" >Please rotate your device to landscape mode.</div>

  <!-- Game Rules Modal -->
  <div id="rules-modal">
    <div id="rules-modal-content">
      <button id="close-rules-btn">✖</button>
      <h2 id="rules-title"></h2>

      <ol>
        <li>El juego es para 4 jugadores en equipos de 2.</li>
        <li>El juego empieza cuando los 4 jugadores esten inscritos</li>
        <li>El juego rota las parejas despues de cada match</li>
        <li>Cada jugador recibe 7 fichas de dominó.</li>
        <li>El jugador con el doble 6 inicia la partida.</li>
        <li>Los turnos son en sentido contra del reloj.</li>
        <li>Debe colocar una ficha que coincida con los extremos del tablero.</li>
        <li>Si no puede jugar, debe pasar su turno.</li>
        <li>Gana la mano el primer equipo en quedarse sin fichas, o el equipo con menos puntos si el juego se cierra.</li>
        <li>Si hay cierre y empate en puntos, nadie gana y sale el que tenga el doble 6 en la proxima mano</li>
        <li>El primer equipo en alcanzar el puntaje objetivo gana el juego.</li>
        <li>Puede crear su propio salón o unirse a uno existente.</li>
      </ol>
    </div>
  </div>
  <!-- Scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js"></script>
<script>
  // Shared state and rules content
  let selectedLanguage = 'es';

  const rulesES = `
    <li>El juego es para 4 jugadores en equipos de 2.</li>
    <li>El juego empieza cuando los 4 jugadores esten inscritos</li>
    <li>El juego rota las parejas despues de cada match</li>
    <li>Cada jugador recibe 7 fichas de dominó.</li>
    <li>El jugador con el doble 6 inicia la partida.</li>
    <li>Los turnos son en sentido contra del reloj.</li>
    <li>Debe colocar una ficha que coincida con los extremos del tablero.</li>
    <li>Si no puede jugar, debe pasar su turno.</li>
    <li>Gana la mano el primer equipo en quedarse sin fichas, o el equipo con menos puntos si el juego se cierra.</li>
    <li>Si hay cierre y empate en puntos, nadie gana y sale el que tenga el doble 6 en la proxima mano</li>
    <li>El primer equipo en alcanzar el puntaje objetivo gana el juego.</li>
    <li>Puede crear su propio salón o unirse a uno existente.</li>
  `;

  const rulesEN = `
    <li>The game is for 4 players in teams of 2.</li>
    <li>The game starts when all 4 players are registered.</li>
    <li>Teams rotate after each match.</li>
    <li>Each player receives 7 domino tiles.</li>
    <li>The player with the double six starts the round.</li>
    <li>Turns proceed counterclockwise.</li>
    <li>You must play a tile that matches one of the board’s ends.</li>
    <li>If you can’t play, you must pass your turn.</li>
    <li>The hand is won by the first team to play all their tiles, or the team with the fewest points if the game is blocked.</li>
    <li>If blocked and tied, no one wins and the next hand starts with the player holding the double six.</li>
    <li>The first team to reach the target score wins the game.</li>
    <li>You can create your own room or join an existing one.</li>
  `;

  // Modal logic
  function openRulesModal() {
    const modal = document.getElementById('rules-modal');
    const title = document.getElementById('rules-title');
    const rulesList = document.querySelector('#rules-modal-content ol');

    if (!modal || !title || !rulesList) return;

    title.textContent = selectedLanguage === 'en'
      ? 'Domino4 - Game Rules'
      : 'Domino4 - Reglas del Juego';

    rulesList.innerHTML = selectedLanguage === 'en' ? rulesEN : rulesES;
    modal.classList.add('show');
  }

  function closeRulesModal() {
    const modal = document.getElementById('rules-modal');
    if (modal) modal.classList.remove('show');
  }

  // Game UI activation
  function showGameUI() {
    document.getElementById('lobby-container')?.style.setProperty('display', 'none');
    document.getElementById('game-ui')?.style.setProperty('display', 'block');
    document.getElementById('scroll-panel')?.style.setProperty('display', 'block');
    document.body.classList.add('in-game');

    if (typeof moveMobileContent === 'function') {
      moveMobileContent();
    }

    const btnScroll = document.getElementById('show-rules-btn-scroll');
    if (btnScroll) {
      btnScroll.addEventListener('click', openRulesModal);
    }
  }

  // DOM ready

  

document.addEventListener('DOMContentLoaded', () => {
  const langSelect = document.getElementById('language-select');
  if (langSelect) {
    selectedLanguage = langSelect.value;
    langSelect.addEventListener('change', (e) => {
      selectedLanguage = e.target.value;
    });
  }

  const showBtn = document.getElementById('show-rules-btn');
  const modal = document.getElementById('rules-modal');
  const closeBtn = document.getElementById('close-rules-btn');
  const title = modal.querySelector('h2');

  if (showBtn && modal && closeBtn && title) {
    showBtn.onclick = () => {
      title.textContent = selectedLanguage === 'en'
        ? 'Domino4 - Game Rules'
        : 'Domino4 - Reglas del Juego';
      modal.classList.add('show');
      document.getElementById('lobby-container').classList.add('modal-open');
    };
    closeBtn.onclick = () => {
      modal.classList.remove('show');
      document.getElementById('lobby-container').classList.remove('modal-open');
    };
    modal.onclick = (e) => {
      if (e.target === modal) {
        modal.classList.remove('show');
        document.getElementById('lobby-container').classList.remove('modal-open');
      }
    };
  }
});
